<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora</title>
    <link rel="stylesheet" href="{{url_for('static', filename = 'styles/calculatorStyle.css')}}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="header">
        <div class = "sideMenuContainer"> <!-- MENU LATERAL -->

            <br>
            <a href = "admin">
                <img id = "unAgendaLabel" src = "{{url_for('static', filename='img/unAgenda1.png')}}" width="100"/>
            </a>

            <br><br>

            <a href = "admin">
                <div class = "iconBox">
                    <img class = "iconImage" src = "{{url_for('static', filename='img/mainmenumini.png')}}" width="100"/>
                </div>
            </a>
            <a href = "schedule">
                <div class = "iconBox">
                    <img class = "iconImage" src = "{{url_for('static', filename='img/scheduleindexmini.png')}}" width="100"/>
                </div>
            </a>
            <a href = "calculator">
                <div class = "iconBox">
                    <img class = "iconImage" src = "{{url_for('static', filename='img/calculatorindexmini.png')}}" width="100"/>
                </div>
            </a>

        </div>


        <div class = "welcomeText">
            <h1>Calculadora de Promedios</h1>
        </div> 
        <div id="botones">
            <button id="addGroupNotes"><img class="img-editNote" src="{{url_for('static', filename='img/icons/anadirGrupoNotas.png')}}" alt="Añadir grupo de notas"></button>
            <button id="editGroupNotes"><img class="img-editNote" src="{{url_for('static', filename='img/icons/editarGrupo.png')}}" alt="Editar grupo de notas"></button>
        </div>    
        <div style="display: none;" id="group-id">
            {% if len_group == 0 %}
                -1
            {% else %}
                {{ len_group - 1}}
            {% endif %}
        </div>
        
        <ul id="groupNotes">
            {% for nota in nota_ordenadas %}
                <li class="li-notes" id="li{{ nota[0]['numGrupo'] }}">
                    <div class="container-note-percentage" >
                        <div  class="percentage">
                            {{ nota[0]["porcentaje"] }}%
                        </div>
                        <div class="container-notes">
                            <ul>
                                {% for n in nota %}
                                    <li>
                                        <div class="container-button-notes">
                                            <form method="post">
                                                <input type="number" id='nota' readonly class="note" value="{{n['nota']}}">
                                                <button class="confirmNote"><img class='img-editNote' src="{{url_for('static', filename='img/icons/confirm_note.png')}}" alt="Editar nota"></button>
                                                <button class="editNote"><img class='img-editNote' src="{{url_for('static', filename='img/icons/editarNota.png')}}" alt="Editar nota"></button>
                                            </form>
                                            <button class="deletNote" id='{{n["idNota"]}}'><img class='img-editNote' src="{{url_for('static', filename='img/icons/borrarNota.png')}}" alt="Borrar nota"></button>

                                            <script>

                                                var removeButton = document.getElementById('{{n["idNota"]}}');
                                                // const ul_groups = document.getElementById('groupNotes');

                                                removeButton.addEventListener("click", function (e) {
                                                    e.preventDefault();
                                                    this.parentNode.parentNode.parentNode.childNodes.forEach(child => {
                                                        if(child.nodeName === '#text'){
                                                            this.parentNode.parentNode.parentNode.removeChild(child);
                                                        }
                                                    });

                                                    ul.childNodes.forEach(child => {
                                                        if(child.nodeName === '#text'){
                                                            ul.removeChild(child);
                                                        }
                                                    });

                                                    console.log(ul.childNodes);

                                                    let id_group = this.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.id.split('li')[1];

                                                    if(this.parentNode.parentNode.parentNode.childNodes.length === 1) {
                                                        window.location.href = "/calculator?deletedEvent=" + this.id + '&delete_group=' + id_group + '&lengthUl=' + ul.childNodes.length;
                                                    } else {
                                                        window.location.href = "/calculator?deletedEvent=" + this.id;
                                                    }

                                                    // console.log(real_child);
                                                    // console.log(this.parentNode.parentNode.parentNode.childNodes);

                                                // window.location.href = "/calculator?deletedEvent=" + this.id;

                                                });

                                            </script>

                                        </div>    
                                    </li>
                                {% endfor %}      
                            </ul>
                            <div>
                                <button class="addNote">Añadir nota</button>
                            </div>
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
        <div id="finalAverage">

            <h4>Tu promedio final es:</h4>
            <p> {{promedioFinal}}</p>

        </div>

        <div class="modal-container" id="modal-container">
            <div class="modal">
                <h2>¿Cuál porcentaje quieres cambiar?</h1>
                <ul>
                {% for nota in nota_ordenadas %}
                    <li class="li-edit-group">
                        <h3>Grupo {{ nota[0]["numGrupo"] + 1 }}</h2>
                        <form action="" method="post" class="form-group">
                            <input type="number" class="input-group" readonly value="{{nota[0]['porcentaje']}}"><p>%</p>
                            <button class="edit-group">Editar</button>
                            <button class="confirm-group">Confirmar</button>
                        </form>
                    </li>
                {% endfor %}
                </ul>
                <button id="close">Cerrar</button>
            </div>
        </div>
    </div>
    <script src="{{url_for('static', filename='js/gestorCalculadora.js')}}"></script>
</body>
</html>